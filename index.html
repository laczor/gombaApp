<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin=""/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div data-testid="add-locations-menu" class="add-locations"></div>
    <dialog data-testid="add-current-location-modal" class="modal"></dialog>
    <div class="testing"></div>
    <div id="map"></div>

</body>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>

<script type="importmap">
    {
      "imports": {
        "db": "./db.js",
        "api": "./api.js",
        "map": "./map.js",
        "markers": "./markers.js",
        "domain": "./domain.js"
      }
    }
</script>

<script>
    const ADD_CURRENT_LOCATION_MODAL = document.querySelector("[data-testid='add-current-location-modal']");
    const ADD_LOCATIONS_MENU = document.querySelector("[data-testid='add-locations-menu']");

</script>


<script type="module">
    import { dbPromise, LOCATIONS_VERSION } from 'db'
    import { Api } from 'api';
    import { Map } from 'map';
    import { Location, isLocation } from 'domain';
    import { Markers } from 'markers';

    import { SaveLocationModal } from './components/save-location-form.js'
    import { AddLocationsMenu } from './components/add-locations-menu.js'
    import { exportData } from './export.js'
    import { importData } from './import.js'

    const api = Api(dbPromise);
    const { map } = Map(L);
    map.markInitialLocation();
    const markers = Markers({ api, map })


    const saveLocationModal = SaveLocationModal({ api, modalElement: ADD_CURRENT_LOCATION_MODAL, addMarker: markers.addMarker, closeMarker: markers.closeMarker });
    saveLocationModal.render();

    AddLocationsMenu(
        {
            menuElement: ADD_LOCATIONS_MENU,
            openModal: saveLocationModal.openModal,
            map,
            exportData: exportData({ getData: api.getAllLocations}),
            importData: importData({saveData: api.saveLocation, validator: isLocation}),
    }).render();

    window.deleteMarker = markers.deleteMarker;
    window.opeSaveLocationModal = saveLocationModal.openModal;

    api.getAllLocations().then((locations) => {
            locations.map(markers.addMarker);
    });

</script>



</html>